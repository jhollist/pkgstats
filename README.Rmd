# pkgstats

<!-- badges: start -->
[![R build status](https://github.com/ropenscilabs/pkgstats/workflows/R-CMD-check/badge.svg)](https://github.com/ropenscilabs/pkgstats/actions?query=workflow%3AR-CMD-check)
[![Project Status: Concept](https://www.repostatus.org/badges/latest/concept.svg)](https://www.repostatus.org/#concept)
<!-- badges: end -->

Extract summary statistics of R package structure and functionality. Also
includes a function to extract statistics of all R packages from a local CRAN
mirror. Not all statistics of course, but a good go at balancing
insightful statistics while ensuring computational feasibility.

## What statistics?

Statistics are derived from these primary sources:

1. Summary of lines-of-code from [`cloc`](https://github.com/hrbrmstr/cloc)
2. Brief summaries of package `DESCRIPTION` file and a couple of other statistics
3. Summaries of all objects created via package code across multiple languages
   and all directories containing source code (`./R`, `./src`, and
   `./inst/include`).
4. A function call network derived from function definitions obtained from
   [`ctags`](https::ctags.io), and references ("calls") to those obtained from
   [`gtags`](https://www.gnu.org/software/global/). This network roughly
   connects every object making a call (as `from`) with every object being
   called (`to`).

A demonstration of typical output is shown below. And yes, static code analyses
are frequently inadequate, and especially when applied to complex languages
like C++, but they are nevertheless a darn sight better than nothing, and they
do provide one of the only ways to construct function call networks across
different languages. This package has been developed with the conviction that
the benefits of being able to extract these networks at all outweigh any
disadvantages arising through potential inaccuracy of static code analyses.

## Installation

The package can be installed with:
```{r remotes, eval = FALSE}
remotes::install_github ("ropenscilabs/pkgtest")
```
And then loaded for use with
```{r library, eval = FALSE}
library (pkgstats)
```
```{r load_all, echo = FALSE, message = FALSE}
devtools::load_all (export_all = FALSE)
```

This package requires both [`ctags`](https://ctags.io) and [GNU
`global`](https://www.gnu.org/software/global/), and includes a function to
ensure your local installation of `ctags` works correctly. Please ensure you
see the following prior to proceeding:

```{r ctags-check}
ctags_test ()
```

## Demonstration

The following code demonstrates the output of the main function, `pkgstats`,
applied to the relatively simple [`magrittr`
package](https://github.com/tidyverse/magrittr). The `system.time` call also
shows that these statistics are extracted very quickly.

```{r demo}
tarball <- "magrittr_2.0.1.tar.gz"
u <- paste0 ("https://cran.r-project.org/src/contrib/",
             tarball)
f <- file.path (tempdir (), tarball)
download.file (u, f)
system.time (
    p <- pkgstats (f)
    )
print (p)
```
